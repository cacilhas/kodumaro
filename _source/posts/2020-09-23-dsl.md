---
title: Domain-specific Languages
date: 2020-09-23
tags: dsl scala
permalink: /2020/09/dsl.html
---
[dsl]: https://martinfowler.com/books/dsl.html
[functional]: https://rosettacode.org/wiki/Category:Programming_paradigm/Functional
[imperative]: https://rosettacode.org/wiki/Category:Programming_paradigm/Imperative
[oo]: https://www.amazon.com/gp/product/0136291554/
[scala]: https://www.scala-lang.org/

{:class="pull-right"} <img src="{{{ cacilhas.url }}}/img/scala.png" alt="Scala" />

{:class="mg-first"} When I started working with [Scala][scala], I did it all
wrong. I learned Scala from <em title="Java programmers">oakies</em>, so my team
used Scala just as a syntax sugar for Java.

That’s a great way to underuse Scala strongly.

Scala isn’t Java. Scala binds to Java, but goes forth. Programming in Scala,
you can access Java resources, but even the programming feeling is different.

Both languages are [object-oriented][oo], but Java is an
[imperative language][imperative] in the most strict sense, while Scala is
[impure functional][functional].

Another notable difference is that, even though both languages
are general-purpose, Scala enables creating microlanguages for specific domains,
called [domain-specific languages][dsl], or just **DSL** – which’s very hard to
do using Java.

### The problem

I got a schemaful inbound JSON payload, and I needed to respond an outbound
XML. Midst of format transformation chaos, some keys wasn’t the same, even some
values.

Take the following payload:

```json
{
  "invoice": {
    "general": {
      "date_time": "2020-05-23T01:32:16Z",
      "number": 23,
      "serial": 12,
      "access": "20200523123455012000231X",
    },
    "products": {
        "description": "garlic",
        "ean": "5018605003253",
        "unit_cost": 1.95,
        "amount": 2.50,
        "discount": 0.005,
        "total_cost": 4.87
    }
  }
}
```

The expected output is:

```xml
<invoice id="20200523123455012000231X">
  <ident>
    <dateTime>2020-05-23T01:32:16Z</dateTime>
    <set>12</set>
    <number>23</number>
  </ident>
  <product>
    <name>garlic</name>
    <EAN>5018605003253</EAN>
    <uPrice>1.95</uPrice>
    <amount>2.50</amount>
    <discountValue>0.005</discountValue>
    <subTotal>4.87</subTotal>
  </product>
</invoice>
```

### First solution

The first mapping I tried was traditional: get object, process object, return
XML object.

It was sounding good, until I had to deal with hundreds of different
translations.

### Enter DSL

To solve this complexity issue, I applied my effort in write a DSL.

So, instead of:

```scala
<invoice>
```

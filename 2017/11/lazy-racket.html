<!DOCTYPE html><html lang="pt"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatibile" content="IE=edge"/><meta http-equiv="Pragma" content="no-cache"/><meta http-equiv="Cache-Control" content="no-cache"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content=""/><meta name="author" content="‚Ñúodrigo Arƒ•imedeœÇ ‚Ñ≥ontegasppŒ± ‚Ñ≠acilhŒ±œÇ"/><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Kavivanar"/><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto&amp;subset=latin-ext"/><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:i,bold&amp;subset=latin-ext"/><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Mono"/><link rel="stylesheet" href="/css/bootstrap.min.css"/><link rel="stylesheet" href="/css/animate.min.css"/><link rel="stylesheet" href="/css/bootstrap-dropdownhover.min.css"/><link rel="stylesheet" href="/css/ie10-viewport-bug-workaround.css"/><link rel="stylesheet" href="/css/bootstrap-theme.min.css"/><link rel="stylesheet" href="/css/theme.css"/><link rel="stylesheet" href="/css/cacilhas.css"/><title>Kodumaro :: Lazy Racket</title><meta property="og:site_name" content="Kodumaro"/><meta property="og:title" content="Lazy Racket"/><meta property="og:url" content="https://cacilhas.info/kodumaro/2017/11/lazy-racket.html"/><meta property="og:type" content="article"/><meta property="article:tag" content="Functional, LISP"/><meta property="article:author" content="Arƒ•imedeœÇ ‚Ñ≥ontegasppŒ± ‚Ñ≠acilhŒ±œÇ"/><meta property="og:image" content="https://cacilhas.info/img/racket.jpg"/><link rel="alternate" type="application/atom+xml" title="Kodumaro" href="https://kodumaro.cacilhas.info/feed.xml"/><link rel="stylesheet" href="/css/kodumaro.css"/><link rel="icon" href="/img/icons/kodumaro.ico"/><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script><script src="/js/ie-emulation-modes-warning.js"></script><script src="/js/jquery.min.js"></script><script src="/js/bootstrap-dropdownhover.min.js"></script><script src="/js/handle-old-url.js"></script><script src="/js/alt-title.js"></script><script src="/js/anchors.js"></script><script async="async" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-5741846017654057",
  enable_page_level_ads: true,
})
</script><script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,"script","https://www.google-analytics.com/analytics.js","ga")
ga("create", "UA-99357497-1", "auto")
ga("send", "pageview")</script></head><body><nav class="navbar navbar-inverse navbar-fixed-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-togge="collapse" data-target="#navbar" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="dropdown"><span class="navbar-brand dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">‚Ñ≠acilhŒ±œÇ.INFO</span><ul class="dropdown-menu"><li><a href="https://cacilhas.info"><i class="glyphicon glyphicon-home"></i>&nbsp;‚Ñ≠acilhŒ±œÇ.INFO</a></li><li><a href="https://montegasppa.cacilhas.info/"><i class="licon icon-montegasppa"></i>&nbsp;‚Ñ≥ontegasppŒ± and Giulia C.‚Äôs Thoughts</a></li><li><a href="https://kodumaro.cacilhas.info/"><i class="licon icon-kodumaro"></i>&nbsp;Kodumaro</a></li><li><hr/></li><li><a href="https://www.educaedu-brasil.com/" target="_blank"><i class="licon icon-educaedu"></i>&nbsp;Educaedu Brasil</a></li><li><a href="https://hondaj.cacilhas.info/" target="_blank"><i class="licon icon-hondaj"></i>&nbsp;ƒ§√∏≈ÖƒêŒîjÃÜ‚ÇÄ</a></li><li><a href="https://vortaro.cacilhas.info/" target="_blank"><i class="glyphicon glyphicon-link"></i>&nbsp;Konsulta Vortaro</a></li><li><a href="https://cacilhas.info/maven" target="_blank"><i class="licon icon-maven"></i>&nbsp;Kodumaro Maven Repository</a></li><li><a href="https://claudiotorcato.wordpress.com/" target="_blank"><i class="licon icon-wordpress"></i>&nbsp;Mosaico Livre</a></li><li><a href="https://www.patreon.com/cacilhas" target="_blank"><i class="licon icon-patreon"></i>&nbsp;‚Ñ≥ontegasppŒ±</a></li><li><a href="https://montegasppa.bandcamp.com/releases" target="_blank"><i class="licon icon-le-obscur-essentes"></i>&nbsp;Le Obscur EssenteœÇ</a></li><li><a href="https://www.todasfridas.com.br/" target="_blank"><i class="licon icon-fridas"></i>&nbsp;Todas Fridas</a></li><li><a href="https://waltercruz.com/" target="_blank"><i class="glyphicon glyphicon-link"></i>&nbsp;Walter Cruz</a></li><li><a href="https://dev.to/cacilhas" target="_blank"><i class="licon icon-dev-to"></i>&nbsp;DEV Profile üë©‚Äçüíªüë®‚Äçüíª</a></li><li><a href="https://medium.com/@cacilhas" target="_blank"><i class="licon icon-medium"></i>&nbsp;Medium.com/@cacilhas</a></li></ul></div></div><div class="collapse navbar-collapse" id="navbar"><ul class="nav navbar-nav"><li><a href="https://cacilhas.info/"><i class="glyphicon glyphicon-home"></i>&nbsp;
Home</a></li><li><a href="https://cacilhas.info/about.html">About</a></li><li><a href="https://kodumaro.cacilhas.info/">Kodumaro</a></li><li class="active"><a href=".">Lazy Racket</a></li></ul></div></div></nav><div class="container"><div class="panel panel-default"><div class="panel-heading"><h2 class="mg-title">Kodumaro :: Lazy Racket</h2><h6 class="pull-right">Released on November 2nd, 2017</h6><h6>The shadows behind the code.</h6></div><div class="panel-body"><img class="pull-right" src="/img/racket.jpg" alt="Racket"/><p class="mg-first">Dando continuidade ao <a href="https://kodumaro.cacilhas.info/2017/11/lisp.html">artigo anterior</a>, podemos abordar dois <em>patterns</em> interessantes: acumuladores e
 avalia√ß√£o tardia. Usaremos como plataforma <a href="http://racket-lang.org/">Racket</a>, portanto voc√™ vai precisar <a href="https://download.racket-lang.org/">instal√°-lo</a>.</p><h3>Acumuladores</h3><p>Acumulador √© um <em>pattern</em> muito comum em <a href="https://pt.wikipedia.org/wiki/Programa√ß√£o_funcional">programa√ß√£o funcional</a> e <a href="https://pt.wikipedia.org/wiki/Programa√ß√£o_l√≥gica">l√≥gica</a>. Consistem em tirar proveito de <a href="http://wiki.c2.com/?TailCallOptimization"><em>tail-call optimisation</em></a> (TCO) em recurs√µes lineares ou bin√°rias.</p><p>Vamos ao mesmo exemplo do artigo anterior, <a href="https://pt.wikipedia.org/wiki/Fatorial">fatorial</a>.</p><p>O passo do fatorial √© definido como o pr√≥prio n√∫mero vezes o fatorial de seu antecessor, enquanto a parada √© o fatorial de zero, igual a um:</p><pre><code>n! = n √ó (n - 1)!
0! = 1
</code></pre><p>Implementando isso em Racket fica:</p><pre class="prettyprint"><code>(define factorial
  (Œª (n)
    [if (zero? n)
        1
        (* n (factorial (- n 1)))]))
</code></pre><p>O corpo da fun√ß√£o Œª possui apenas a instru√ß√£o <code>'if</code>, que roda <code>'zero?</code> para verificar a condi√ß√£o ‚Äì para determinar se se trata do
 passo ou da parada.</p><p>Se for a parada (0!), retorna 1, caso contr√°rio retorna o resultado dainstru√ß√£o <code>'*</code>.</p><p>Portanto, a √∫ltima instru√ß√£o, que tirar√° proveito de TCO ser√° a multiplica√ß√£o. Por√©m quem efetua a recurs√£o, promovendo o empilhamento de <em>stacks</em> de
 fun√ß√£o, √© <code>'factorial</code>.</p><p>Assim, para aproveitar TCO na recurs√£o, √© necess√°rio que a √∫ltima instru√ß√£o seja a chamada da recurs√£o.</p><p>Pra que isso seja poss√≠vel, √© preciso carregar o resultado acumulado atrav√©s dos <em>stacks</em> como par√¢metro, para que seja retornado na parada. Esta
 carga de valor acumulado √© chamada acumulador.</p><p>Ent√£o precisamos de uma fun√ß√£o que receba o n√∫mero para o qual se deseja calcular o fatorial <strong>e</strong> o valor acumulado ‚Äì o acumulador.
 Chamaremos essa fun√ß√£o de <code>'*factorial*</code>.</p><p>A fun√ß√£o ‚Äúprovida‚Äù, <code>'factorial</code>, dever√° chamar <code>'*factorial*</code> passando o n√∫mero para o qual o fatorial deve ser calculado e, como valor
 inicial do acumulador, o valor retornado na parada (1):</p><pre class="prettyprint"><code>(define factorial
  (Œª (n)
    *factorial* n 1))
</code></pre><p>Todo o trabalho pesado deve ser feito em <code>'*factorial*</code>. O algoritmo √© quase id√™ntico ao da fun√ß√£o original, apenas retornando o valor acumulado
 para a parada e, para o passo, retorna a chamada recursiva. A
 multiplica√ß√£o ser√° efetuada para calcular o pr√≥ximo valor do acumulador,
 passado como par√¢metro para o pr√≥ximo passo:</p><pre class="prettyprint"><code>(define *factorial*
  (Œª (n acc)
    [if (zero? n)
        acc
        (*factorial* (- n 1) (* acc n))]))
</code></pre><p>Agora temos o c√°lculo fatorial tirando proveito de TCO, o que torna a fun√ß√£o t√£o eficiente quando uma fun√ß√£o reiterativa numa linguagem imperativa, mas
 usando uma abordagem recursiva, muito mais leg√≠vel e intelig√≠vel.</p><h3>Avalia√ß√£o tardia ou pregui√ßosa (<em>lazy evaluation</em>)</h3><p>As estrat√©gias mais eficientes para lidar com grandes volumes de dados calculados ‚Äì¬†e at√© com quantidades infinitas ‚Äì √© a <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">avalia√ß√£o tardia</a> ou <em>call-by-need</em>. Linguagens como <a href="https://www.haskell.org/">Haskell</a> resolvem os valores das fun√ß√µes sob demanda, ou seja, se uma fun√ß√£o √©
 chamada, mas seu resultado n√£o √© usado, o corpo da fun√ß√£o <strong>n√£o</strong> √©
 executado ‚Äì ser√° apenas quando o retorno for necess√°rio.</p><p>Isso d√° ao programador recursos poderosos, como definir Fibonacci como uma uma fun√ß√£o que retorna uma lista infinita:</p><pre class="prettyprint"><code>fib :: [Integer]
fib = 1 : 1 : zipWith (+) fib (tail fib)
</code></pre><p>Aqui se declara <code>fib</code> como uma fun√ß√£o que retorna uma lista de inteiros (<code>Integer</code>) e se define o retorno como 1 seguido de 1, seguido da
 soma de cada elemento retornado por <code>fib</code> com cada elemento
 retornado por <code>fib</code> exceto o primeiro (<code>tail</code>).</p><p>Isso s√≥ √© poss√≠vel porque cada elemento da lista retornada por <code>fib</code> s√≥ √© avaliado quando necess√°rio.</p><p>Para trazer os 10 primeiros elementos de Fibonacci, solicitamos a avalia√ß√£o dos mesmos usando <code>take</code>:</p><pre><code><em>ghci&gt;</em> <strong>take 10 fib</strong>
<em>[1,1,2,3,5,8,13,21,34,55</em>]
<em>ghci&gt;</em>

</code></pre><h3><em>Promises</em></h3><p>O recurso de <a href="http://docs.racket-lang.org/lazy/">Lazy Racket</a> para fazer avalia√ß√£o tardia √© chamado <em>promise</em> (promessa), que √©
 totalmente diferente de <em>promise</em> em <a href="https://nodejs.org/en/">Node.js</a>, mas muito similar √† forma como Haskell lida com fun√ß√µes tardiamente.</p><p>Ao declarar um c√≥digo como Lazy Racket com o <em>hash bang</em> <code>#!lazy</code>, ou importando o m√≥dulo (<code>(require lazy)</code>), isso sobrescreve muitas
 das fun√ß√µes por vers√µes pregui√ßosas, que retornam uma <em>promise</em> em vez
 de avaliar imediatamente seu resultado.</p><p>Ainda introduz a fun√ß√£o <code>'!!</code>, que for√ßa a resolu√ß√£o da <em>promise</em>.</p><p>Vamos ent√£o criar um m√≥dulo chamado <code>fact.rkt</code> que prov√™ uma vers√£o pregui√ßosa do c√°lculo do fatorial, que pode ser usado paralelamente e sob
 demanda. Repare que o corpo das fun√ß√µes √© exatamente igual ao que fizemos
 acima:</p><pre class="prettyprint"><code>#!lazy
;; fact.rkt

(provide factorial)

(define *factorial*
  (Œª (n acc)
    [if (zero? n)
        acc
        (*factorial* (- n 1) (* acc n))]))

(define factorial
  (Œª (n)
    *factorial* n 1))
</code></pre><p>Podemos validar no <em>prompt</em> do <code>racket</code>:</p><pre><code><em>-&gt;</em> <strong>(require "fact.rkt")</strong>
<em>-&gt;</em> <strong>(require lazy)</strong>
<em>-&gt;</em> <strong>(!! &#91;map (lambda (n) `(,n ,(factorial n))) '(0 1 2 3 4 5)&#93;)</strong>
<em>'((0 1) (1 1) (2 2) (3 6) (4 24) (5 120))</em>
</code></pre><p>O <code>'map</code> gera uma <em>promise</em> que valida o <em>lambda</em> sob demanda para cada valor da lista <code>'(0 1 2 3 4 5)</code>.</p></div></div><p class="text-right"><small class="tag"><a href="/tags/functional.html">Functional</a></small> | <small class="tag"><a href="/tags/lisp.html">LISP</a></small></p><div class="panel panel-default"><div class="panel-body"><div class="pull-left"><small><a href="https://kodumaro.cacilhas.info/2017/11/lisp.html">¬´ Previous: LISP</a></small></div><div class="pull-right"><small><a href="https://kodumaro.cacilhas.info/2017/11/acumuladores.html">Next: Acumuladores em programa√ß√£o l√≥gica ¬ª</a></small></div></div></div><div class="panel panel-default"><div class="panel-body"><div id="disqus_thread"></div><script language="javascript">var disqus_config = function() {
  this.page.url = `https://cacilhas.info/kodumaro/2017/11/lazy-racket.html`
  this.page.identifier = `kodumaro.2017.11.lazy-racket`
  this.page.title = 'Lazy Racket'
}</script><noscript>Please enable JavaScript to view the comments <a href="https://disqus.com/?ref_noscript">powered by Disqus</a>.</noscript></div></div><div><div class="pull-left"><script async="async" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px;" data-ad-client="ca-pub-5741846017654057" data-ad-slot="7936078120"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({})</script></div><div class="pull-left"><iframe src="https://bandcamp.com/band_follow_button_deluxe/2598801931" width="300" height="56" scrolling="no" frameboarder="0" style="border: none; width: 100%; overflow: hidden;" allowtransparency></iframe></div><div class="pull-left"><a href="https://dev.to/cacilhas"><img src="https://d2fltix0v2e0sb.cloudfront.net/dev-badge.svg" alt="DEV Profile üë©‚Äçüíªüë®‚Äçüíª" height="30" width="30"></a></div></div></div><div class="panel-footer" id="footer"><p class="pull-left"><a href="https://kodumaro.cacilhas.info/feed.xml" target="_blank" type="application/atom+xml"><img src="/img/rss.png" alt="feed"></a></p><p class="small">Author: Arƒ•imedeœÇ ‚Ñ≥ontegasppŒ± ‚Ñ≠acilhŒ±œÇ &nbsp;<a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.pt"><img alt="[CC-BY 4.0]" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0;"></a></p></div><script src="/js/bootstrap.min.js"></script><script src="/js/ie10-viewport-bug-workaround.js"></script><script src="/js/kodumaro.disqus.js"></script><script id="dsq-count-scr" src="//kodumaro.disqus.com/count.js" async></script><script language="javascript">$(document).ready(function() {
  $('[title]').tooltip();
})</script></body></html>